# 🎛️ 管理员控制面板 - 完整设计方案

**项目**: 物流通 PDA 系统 (Hedui Logistics)
**目标**: 创建一个全功能的管理员控制面板，统一管理系统配置、用户权限、公司设置、批次管理等
**工具**: Stitch (Google AI Studio)

---

## 📋 目录

1. [核心功能模块](#核心功能模块)
2. [页面结构设计](#页面结构设计)
3. [功能详细说明](#功能详细说明)
4. [UI/UX 设计要点](#uiux-设计要点)
5. [数据库支持](#数据库支持)
6. [实施优先级](#实施优先级)

---

## 🎯 核心功能模块

### 1. 👥 用户与权限管理
**目标**: 统一管理所有用户账号、角色和权限

#### 功能点：
- ✅ **用户列表**
  - 显示所有用户（sender, transit, receiver, admin）
  - 支持搜索、筛选（按角色、状态、公司）
  - 显示用户状态（活跃/禁用/锁定）
  - 显示最后登录时间

- ✅ **添加用户**
  - 邮箱 + 密码
  - 选择角色（sender/transit/receiver/admin/supervisor）
  - 关联公司
  - 设置权限组

- ✅ **编辑用户**
  - 修改基本信息（姓名、邮箱、电话）
  - 重置密码
  - 修改角色
  - 启用/禁用账号
  - 强制登出

- ✅ **权限管理**
  - 角色权限矩阵（查看/编辑/删除/审批）
  - 自定义权限组
  - 功能模块访问控制
  - API 权限配置

- ✅ **批量操作**
  - 批量导入用户（CSV/Excel）
  - 批量禁用/启用
  - 批量修改公司关联

---

### 2. 🏢 公司配置管理
**目标**: 管理所有合作公司的信息和配置

#### 功能点：
- ✅ **公司列表**
  - 显示所有公司（sender/transit/receiver）
  - 公司代码、名称、角色、状态
  - 关联用户数量
  - 活跃批次数量

- ✅ **添加公司**
  - 公司名称（中文/英文/越南文）
  - 公司代码（唯一标识）
  - 公司角色（sender/transit/receiver）
  - 联系信息（地址、电话、邮箱）
  - 税务信息（税号、开票信息）

- ✅ **编辑公司**
  - 修改基本信息
  - 修改联系人
  - 启用/禁用公司
  - 设置默认单价

- ✅ **公司关系管理**
  - 设置合作关系（哪些 sender 可以用哪些 transit）
  - 设置优先级
  - 设置结算周期

- ✅ **公司统计**
  - 批次数量统计
  - 账单金额统计
  - 支付状态统计
  - 异常率统计

---

### 3. 📦 批次管理
**目标**: 全局批次监控和管理

#### 功能点：
- ✅ **批次总览**
  - 所有批次列表（不受公司限制）
  - 状态分布（待处理/运输中/已完成）
  - 实时更新

- ✅ **批次搜索**
  - 按批次号搜索
  - 按日期范围筛选
  - 按公司筛选
  - 按状态筛选
  - 按重量范围筛选

- ✅ **批次编辑**
  - 修改批次状态（强制推进/回退）
  - 修改单价（已完成批次也可修改）
  - 修改重量
  - 重新分配公司

- ✅ **批次操作**
  - 强制完成批次
  - 取消批次
  - 合并批次
  - 拆分批次
  - 重新计算账单

- ✅ **批次审计**
  - 查看批次操作日志
  - 查看状态变更历史
  - 查看单价修改历史
  - 导出审计报告

---

### 4. 💰 财务配置
**目标**: 统一管理财务相关配置

#### 功能点：
- ✅ **价格策略**
  - 全局默认单价设置
  - 按公司设置单价
  - 按时间段设置单价（促销）
  - 单价历史记录

- ✅ **汇率管理**
  - VND ↔ CNY 汇率设置
  - 汇率历史记录
  - 自动汇率更新（API 对接）
  - 汇率生效时间

- ✅ **结算配置**
  - 结算周期设置（日结/周结/月结）
  - 自动结算规则
  - 账单模板配置
  - 发票配置

- ✅ **支付配置**
  - 支付方式管理
  - 支付网关配置
  - 自动对账规则

---

### 5. ⚙️ 系统设置
**目标**: 系统级配置和开关

#### 功能点：
- ✅ **功能开关**
  - 批次自动完成（开/关）
  - 账单自动生成（开/关）
  - 异常自动通知（开/关）
  - 重量验证严格模式（开/关）
  - 允许修改已完成批次（开/关）

- ✅ **通知配置**
  - 邮件通知开关
  - 短信通知开关
  - 系统内通知开关
  - 通知模板管理

- ✅ **打印配置**
  - Bartender 配置
  - 打印模板管理
  - 默认打印机设置
  - 标签格式配置

- ✅ **PDA 配置**
  - 扫码模式（连续/单次）
  - 扫码提示音（开/关）
  - 扫码震动（开/关）
  - 扫码超时时间

- ✅ **数据保留**
  - 日志保留天数
  - 批次归档规则
  - 自动清理规则

---

### 6. 📊 监控与报表
**目标**: 实时监控系统运行状态

#### 功能点：
- ✅ **系统监控**
  - 在线用户数
  - 今日批次数
  - 今日账单金额
  - 系统错误率
  - API 响应时间

- ✅ **业务报表**
  - 批次统计报表
  - 财务统计报表
  - 公司业绩报表
  - 异常统计报表

- ✅ **审计日志**
  - 用户操作日志
  - 数据修改日志
  - 登录日志
  - API 调用日志

- ✅ **风险监控**
  - 异常批次监控
  - 重量差异监控
  - 账单异常监控
  - 用户异常行为监控

---

### 7. 🔐 安全与审计
**目标**: 确保系统安全和数据可追溯

#### 功能点：
- ✅ **安全设置**
  - 密码策略（长度、复杂度、过期时间）
  - 登录限制（IP 白名单、设备限制）
  - 会话管理（超时时间、并发登录）
  - 双因素认证（2FA）

- ✅ **审计追踪**
  - 所有数据修改记录
  - 敏感操作审计
  - 导出审计报告
  - 合规性检查

- ✅ **备份与恢复**
  - 数据库备份计划
  - 手动备份
  - 数据恢复
  - 备份验证

---

### 8. 🔧 高级功能
**目标**: 提升系统灵活性和扩展性

#### 功能点：
- ✅ **API 管理**
  - API Key 生成
  - API 权限配置
  - API 调用统计
  - API 文档

- ✅ **Webhook 配置**
  - 批次状态变更通知
  - 账单生成通知
  - 支付成功通知
  - 自定义 Webhook

- ✅ **数据导入导出**
  - 批量导入批次
  - 导出批次数据
  - 导出账单数据
  - 导出用户数据

- ✅ **系统维护**
  - 数据库优化
  - 缓存清理
  - 日志清理
  - 系统健康检查

---

## 🎨 页面结构设计

### 主导航结构

```
管理员控制面板
├── 📊 仪表盘 (Dashboard)
│   ├── 系统概览
│   ├── 实时统计
│   ├── 快速操作
│   └── 最近活动
│
├── 👥 用户管理 (Users)
│   ├── 用户列表
│   ├── 添加用户
│   ├── 角色权限
│   └── 批量操作
│
├── 🏢 公司管理 (Companies)
│   ├── 公司列表
│   ├── 添加公司
│   ├── 公司关系
│   └── 公司统计
│
├── 📦 批次管理 (Batches)
│   ├── 批次总览
│   ├── 批次搜索
│   ├── 批次编辑
│   └── 批次审计
│
├── 💰 财务配置 (Finance)
│   ├── 价格策略
│   ├── 汇率管理
│   ├── 结算配置
│   └── 支付配置
│
├── ⚙️ 系统设置 (Settings)
│   ├── 功能开关
│   ├── 通知配置
│   ├── 打印配置
│   ├── PDA 配置
│   └── 数据保留
│
├── 📊 监控报表 (Monitoring)
│   ├── 系统监控
│   ├── 业务报表
│   ├── 审计日志
│   └── 风险监控
│
├── 🔐 安全审计 (Security)
│   ├── 安全设置
│   ├── 审计追踪
│   └── 备份恢复
│
└── 🔧 高级功能 (Advanced)
    ├── API 管理
    ├── Webhook 配置
    ├── 数据导入导出
    └── 系统维护
```

---

## 🎨 UI/UX 设计要点

### 设计风格
- **主题**: 专业、高效、数据密集
- **色彩**: 深色主题 + 高对比度（适合长时间使用）
- **布局**: 左侧导航 + 顶部操作栏 + 主内容区
- **响应式**: 支持桌面和平板（不强制支持手机）

### 关键组件

#### 1. 仪表盘卡片
```
┌─────────────────────────────┐
│ 📊 今日批次数               │
│                             │
│     1,234                   │
│     ↑ 12% vs 昨天           │
└─────────────────────────────┘
```

#### 2. 数据表格
- 支持排序、筛选、分页
- 支持批量选择
- 支持导出（CSV/Excel/PDF）
- 支持列自定义显示

#### 3. 操作按钮
- 主操作：大按钮，高对比度
- 次要操作：小按钮，低对比度
- 危险操作：红色，需要二次确认

#### 4. 表单设计
- 清晰的字段分组
- 实时验证
- 智能提示
- 自动保存草稿

#### 5. 通知系统
- Toast 通知（操作反馈）
- 系统通知（重要事件）
- 邮件通知（异步事件）

---

## 💾 数据库支持

### 现有表格利用

| 表名 | 用途 | 管理功能 |
|------|------|----------|
| `profiles` | 用户信息 | 用户管理 |
| `companies` | 公司信息 | 公司管理 |
| `batches` | 批次数据 | 批次管理 |
| `bills` | 账单数据 | 财务配置 |
| `exchange_rates` | 汇率数据 | 汇率管理 |
| `settings` | 系统设置 | 系统设置 |
| `operation_logs` | 操作日志 | 审计日志 |
| `audit_logs` | 审计日志 | 安全审计 |
| `batch_price_rules` | 价格规则 | 价格策略 |

### 需要新增的表格

```sql
-- 功能开关表
CREATE TABLE feature_flags (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    feature_key VARCHAR(100) UNIQUE NOT NULL,
    enabled BOOLEAN DEFAULT false,
    description TEXT,
    updated_by UUID REFERENCES profiles(id),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 系统配置表（键值对）
CREATE TABLE system_configs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value JSONB,
    config_type VARCHAR(50), -- string, number, boolean, json
    description TEXT,
    updated_by UUID REFERENCES profiles(id),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 权限组表
CREATE TABLE permission_groups (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    permissions JSONB, -- {batches: {view: true, edit: false}, ...}
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 用户权限关联表
CREATE TABLE user_permissions (
    user_id UUID REFERENCES profiles(id),
    permission_group_id UUID REFERENCES permission_groups(id),
    PRIMARY KEY (user_id, permission_group_id)
);

-- API Key 表
CREATE TABLE api_keys (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    key_name VARCHAR(100) NOT NULL,
    api_key VARCHAR(255) UNIQUE NOT NULL,
    user_id UUID REFERENCES profiles(id),
    permissions JSONB,
    expires_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    last_used_at TIMESTAMPTZ
);

-- Webhook 配置表
CREATE TABLE webhooks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    url TEXT NOT NULL,
    events TEXT[], -- ['batch.completed', 'bill.created', ...]
    secret VARCHAR(255),
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 🎯 实施优先级

### Phase 1: 核心功能（第1-2周）
**优先级**: ⭐⭐⭐⭐⭐

1. **仪表盘** - 系统概览和快速统计
2. **用户管理** - 用户列表、添加、编辑、禁用
3. **公司管理** - 公司列表、添加、编辑
4. **批次管理** - 批次总览、搜索、基本编辑

**Stitch 生成顺序**:
1. Dashboard 页面（仪表盘）
2. User Management 页面（用户列表 + 添加用户表单）
3. Company Management 页面（公司列表 + 添加公司表单）
4. Batch Management 页面（批次列表 + 搜索筛选）

---

### Phase 2: 配置功能（第3-4周）
**优先级**: ⭐⭐⭐⭐

1. **财务配置** - 价格策略、汇率管理
2. **系统设置** - 功能开关、通知配置
3. **权限管理** - 角色权限矩阵

**Stitch 生成顺序**:
1. Finance Config 页面（价格策略 + 汇率管理）
2. System Settings 页面（功能开关 + 配置项）
3. Permission Management 页面（权限矩阵）

---

### Phase 3: 监控审计（第5-6周）
**优先级**: ⭐⭐⭐

1. **监控报表** - 系统监控、业务报表
2. **审计日志** - 操作日志、审计追踪
3. **安全设置** - 密码策略、登录限制

**Stitch 生成顺序**:
1. Monitoring Dashboard 页面（实时监控）
2. Audit Logs 页面（日志查看）
3. Security Settings 页面（安全配置）

---

### Phase 4: 高级功能（第7-8周）
**优先级**: ⭐⭐

1. **API 管理** - API Key 生成、权限配置
2. **Webhook 配置** - 事件订阅、通知配置
3. **数据导入导出** - 批量操作、数据迁移

**Stitch 生成顺序**:
1. API Management 页面
2. Webhook Config 页面
3. Data Import/Export 页面

---

## 📐 Stitch 提示词模板

### 模板 1: 仪表盘页面
```
创建一个管理员仪表盘页面，包含以下元素：

布局：
- 顶部：欢迎信息 + 快速操作按钮
- 中间：4个统计卡片（今日批次、今日账单、在线用户、系统错误）
- 下方：2列布局
  - 左侧：最近批次列表（表格）
  - 右侧：系统活动日志（时间线）

设计风格：
- 深色主题（#1a1a2e 背景）
- 高对比度文字
- 卡片使用微妙阴影
- 数据用大号数字显示
- 趋势用小图标表示（↑ ↓）

交互：
- 统计卡片可点击查看详情
- 表格支持排序
- 日志可展开查看详情
```

### 模板 2: 用户管理页面
```
创建一个用户管理页面，包含以下功能：

顶部操作栏：
- 搜索框（按邮箱、姓名搜索）
- 筛选器（按角色、状态筛选）
- "添加用户"按钮（主按钮，右上角）

主内容区：
- 用户列表表格，包含列：
  - 头像 + 姓名
  - 邮箱
  - 角色（带颜色标签）
  - 公司
  - 状态（活跃/禁用）
  - 最后登录时间
  - 操作按钮（编辑/禁用/删除）

右侧抽屉：
- 添加/编辑用户表单
- 字段：邮箱、姓名、角色、公司、密码
- 保存/取消按钮

设计风格：
- 表格使用斑马纹
- 角色用不同颜色标签（sender=蓝色, transit=绿色, receiver=橙色, admin=红色）
- 操作按钮用图标表示
```

---

## 🎯 总结

这个管理员控制面板设计涵盖了：

### ✅ 已包含的功能
1. ✅ 用户账号密码管理
2. ✅ 权限设置
3. ✅ 公司配置
4. ✅ 批次修改
5. ✅ 功能开关
6. ✅ 财务配置
7. ✅ 系统设置
8. ✅ 监控报表
9. ✅ 安全审计
10. ✅ API 管理

### 🚀 额外的创新功能
1. 🎯 **实时监控仪表盘** - 一目了然的系统状态
2. 🔔 **智能通知系统** - 多渠道通知配置
3. 📊 **可视化报表** - 图表化的业务数据
4. 🔐 **细粒度权限控制** - 精确到功能级别的权限
5. 🔧 **Webhook 集成** - 与第三方系统对接
6. 📦 **批量操作** - 提升管理效率
7. 🕐 **审计追踪** - 完整的操作历史
8. 🌐 **多语言支持** - 中文/越南文/英文
9. 🎨 **深色模式** - 适合长时间使用
10. 📱 **响应式设计** - 支持桌面和平板

---

**下一步**: 请确认设计方案，我将使用 Stitch 工具开始生成页面！
