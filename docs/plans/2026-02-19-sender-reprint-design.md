# 设计文档: 发送方扫码快速重印标签功能

## 1. 概述 (Overview)
针对外籍员工在操作过程中可能遇到的打印失败或标签损坏问题，设计一套基于“直觉化扫描”的标签重现功能。当员工扫描一个已在该批次存在的运单号时，系统自动识别并引导其进行重印，而非报错或重复提交。

## 2. 背景与目标 (Background & Goals)
- **目标用户**：外籍发送方员工（可能存在语言障碍）。
- **核心目标**：
    - 降低操作复杂度，减少文字阅读。
    - 建立“扫描已存单号即代表重印”的操作心智。
    - 提供极其明显的视觉反馈，防止误操作。

## 3. 详细设计 (Detailed Design)

### 3.1 逻辑流程
1. 员工在 `CargoCreate` 页面扫描包裹运单号。
2. 系统检索当前活跃批次中的已存在件。
3. 如果单号已存在：
    - 触发 PDA 短促震动。
    - 界面进入 **紫色重印模式 (Reprint Mode)**。
4. 在重印模式下：
    - 表单输入框变为紫色边框和背景，并显示“重复”状态图标。
    - 底部原本的“确认”按钮被替换为 **巨型紫色重印按钮**。
5. 点击紫色按钮：
    - 直接提取该件的重量、尺寸、单号等数据。
    - 调用 `printLabel` 服务进行蓝牙打印。
    - 打印指令发出后，界面自动清空单号，切回普通“建档”模式。

### 3.2 UI 规范
- **重印模式主色调**：`#8B5CF6` (Vibrant Purple / Indigo)。
- **巨型按钮设计**：
    - 高度：占据屏幕底部约 25% 的位置。
    - 图标：超大 `material-icons-round` 打印机图标。
    - 辅助信息：显示运单号最后 4 位数字，强化关联感。
- **反馈动画**：使用 `framer-motion` 进行模式切换时的平滑缩放与颜色过渡。

### 3.3 异常处理
- **误读单号**：如果员工扫描后发现扫错了（或不需要重印），可以通过点击输入框旁边的“清空”图标（✕）或手动删除单号，界面立即无感知恢复普通模式。
- **离线打印**：若蓝牙打印机断开，紫色按钮将变为灰色，并显示明显的“断开”图标，引导员工去设置界面。

## 4. 实施路径 (Implementation)
1. **State 管理**：在 `CargoCreate/index.tsx` 中新增 `duplicateShipment` 状态。
2. **UI 组件更新**：
    - 修改 `CargoCreateForm` 增强输入框的状态渲染。
    - 修改 `CargoCreateFooter` 允许根据 `duplicateShipment` 状态切换按钮。
3. **打印关联**：确保 `printShipmentLabel` 函数能直接接受旧数据作为参数。

## 5. 评审通过 (Approval)
- 用户已于 2026-02-19 确认方案。
